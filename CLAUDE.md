# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a WordPress plugin template designed for creating WooCommerce-compatible plugins. The project is namespaced under `Nvm\Donor` and follows WordPress/WooCommerce coding standards.

**Main entry point:** `nvm-donor.php` - Contains the `Donor` singleton class that bootstraps the plugin.

## Development Commands

### Linting and Code Quality
```bash
# Run PHP linting
npm run php:lint
# or
pnpm run php:lint

# Auto-fix PHP code style issues
npm run php:fix
# or
pnpm run php:fix

# Check PHP compatibility (PHP 8+)
npm run php:compat
# or
pnpm run php:compat
```

### Building
```bash
# Build plugin for distribution (creates build/ directory and ZIP file)
npm run build
# or
pnpm run build

# Copy files to build directory without creating ZIP
npm run copy
# or
pnpm run copy

# Watch for changes and auto-rebuild
npm run watch
# or
pnpm run watch
```

**Note:** All build commands automatically run `composer dumpautoload -o` before executing.

### Composer
```bash
# Install PHP dependencies (vendor directory is prefixed/vendor/)
composer install

# Regenerate optimized autoloader
composer dumpautoload -o
```

## Architecture

### Namespacing and Autoloading
- **Namespace:** `Nvm\Donor`
- **Autoloading:** Custom SPL autoloader (nvm-donor.php:110-134) that maps PSR-4 class names to files in `classes/` directory
- **Class file naming:** Classes use `class-{name}.php` convention (e.g., `class-example.php` for `Nvm\Donor\Example`)
- **Vendor autoloading:** Prefixed vendor directory at `prefixed/vendor/` is loaded automatically via the custom autoloader

### Plugin Structure
The plugin follows a singleton pattern with the main `Donor` class:
- Static properties for plugin metadata (version, paths, URLs)
- `get_instance()` for singleton instantiation
- Lifecycle hooks: `on_plugin_activation()`, `on_plugin_deactivation()`, `on_plugin_uninstall()`

### Directory Layout
- `classes/` - Plugin class files (currently empty in template)
- `css/` - Stylesheets
- `js/` - JavaScript files
- `prefixed/vendor/` - Composer dependencies (custom vendor directory location)
- `build/` - Distribution files (generated by Grunt)

### Build System (Grunt)
The Gruntfile.js defines the build process:
- **copy:all** - Copies plugin files, PHP classes, CSS, and essential vendor files to `build/`
- **build** - Full build including compression to ZIP
- **watch:all** - Auto-rebuilds on file changes (checks every 2 seconds)

Only specific vendor dependencies are copied (analog, psr, composer, autoload.php) - not the entire vendor directory.

## Code Standards

**PHP Code Sniffer:** Configured via `phpcs.xml`
- Follows WooCommerce-Core standards
- Minimum WordPress version: 5.6
- PHP version: 8.0+ (strict requirement in composer.json)
- Text domain should be updated from placeholder: `my-project-text-domain` â†’ `nevma`

**Package naming inconsistency:** The package.json uses `nvm-history-price` while composer.json uses `nvm/donor` - this should be reconciled when customizing the template.

## PHP Requirements

- **Minimum PHP Version:** 8.0
- **WooCommerce Compatibility:** 4.0+ (tested up to 9.4)

## Customizing This Template

When adapting this template for a new plugin:
1. Update plugin header in `nvm-donor.php` (lines 3-15)
2. Rename `nvm-donor.php` to match your plugin slug
3. Update namespace from `Nvm\Donor` throughout codebase
4. Update `$namespace_prefix` in nvm-donor.php:95
5. Reconcile package names in package.json and composer.json
6. Update text domain in phpcs.xml (line 14) and plugin header
7. Add your plugin classes to `classes/` directory
8. Update composer.json autoload PSR-4 mapping if namespace changes
